<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Analyse CV Suisse | BETA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    font-family: Helvetica, Arial, sans-serif;
    background-color: #ffffff;
    color: #1a1a1a;
    text-align: center;
    margin: 0;
    padding: 0;
}
.container {
    width: 90%;
    max-width: 650px;
    margin: auto;
    padding-top: 40px;
}
h1 {
    color: #ea1d2c; /* Couleur Suisse */
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 10px;
}
.subtitle {
    font-size: 16px;
    color: #444;
    margin-bottom: 30px;
}
.uploadBox {
    border: 2px dashed #ea1d2c;
    padding: 35px;
    border-radius: 10px;
    cursor: pointer;
    margin-bottom: 15px;
}
.uploadBox:hover { background-color: #fff5f5; }
.btn {
    background-color: #ea1d2c;
    border: none;
    color: white;
    padding: 12px 22px;
    border-radius: 6px;
    font-size: 15px;
    cursor: pointer;
}
.btn:disabled {
    background-color: #bfbfbf;
    cursor: not-allowed;
}
#selectedFile {
    margin-top: 10px;
    font-size: 14px;
}
.resultBox {
    margin-top: 25px;
    text-align: left;
    background: #fafafa;
    padding: 18px;
    border-radius: 8px;
    border: 1px solid #ddd;
}
</style>
</head>

<body>
<div class="container">

<h1>Analyse CV Suisse üá®üá≠</h1>
<p class="subtitle">T√©l√©charge ton CV ‚Äî version beta gratuite</p>

<label for="fileInput">
<div class="uploadBox">
    üìÑ Cliquez pour importer votre CV (PDF)
</div>
</label>

<input type="file" id="fileInput" accept="application/pdf" style="display:none;">

<div id="selectedFile"><strong>Fichier s√©lectionn√©:</strong> <span id="fileName"></span></div>

<!-- ‚úÖ Ajout n√©cessaire pour √©viter le bug -->
<div id="photoCheck" style="display:none; margin-top:15px; text-align:center;">
    <label style="font-size:14px; color:#333;">
        <input type="checkbox" id="hasPhoto" checked>
        Mon CV contient une photo
    </label>
</div>
<!-- ‚úÖ Fin ajout -->

<div style="text-align: center; margin-top: 25px;">
    <button class="btn" id="analyzeBtn" disabled>Analyser mon CV</button>
</div>

<div id="results" class="resultBox" style="display:none;"></div>

<p style="margin-top:25px;">
üì¨ <a href="https://forms.gle/" target="_blank">Donner un retour (Beta Feedback)</a>
</p>

</div>

<script>
// Elements
const fileInput = document.getElementById('fileInput');
const fileName = document.getElementById('fileName');
const analyzeBtn = document.getElementById('analyzeBtn');
const resultsBox = document.getElementById('results');

// Handle file selection
fileInput.addEventListener("change", function() {
    const file = fileInput.files[0];
    if (!file) return;
    fileName.textContent = file.name;
    analyzeBtn.disabled = false;

    // ‚úÖ Affiche la case photo
    document.getElementById('photoCheck').style.display = 'block';
    document.getElementById('hasPhoto').checked = true;
});

// Analyze
analyzeBtn.addEventListener("click", async () => {
    const file = fileInput.files[0];
    if (!file) return;

    analyzeBtn.textContent = "Analyse en cours...";
    analyzeBtn.disabled = true;
    resultsBox.style.display = "block";
    resultsBox.innerHTML = "‚è≥ Analyse de votre CV selon les standards suisses...";

    const hasPhoto = document.getElementById('hasPhoto').checked;
    
    // Lecture du PDF
    const reader = new FileReader();
    reader.onload = async function() {
        const base64PDF = reader.result.split(',')[1];

        // üî• Requ√™te API Claude / GPT
        const response = await fetch("https://api.openai.com/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": "Bearer VOTRE_CLE_API"
            },
            body: JSON.stringify({
                model: "gpt-4.1-mini",
                messages: [{
                    role: "system",
                    content: "Tu es expert RH Suisse. Analyse le CV selon normes suisses romandes."
                },{
                    role: "user",
                    content: `Voici un CV PDF base64. Photo incluse: ${hasPhoto}. Analyse et score.\nPDF:\n${base64PDF}`
                }]
            })
        });

        const data = await response.json();
        resultsBox.innerHTML = data.choices[0].message.content;
        analyzeBtn.textContent = "Analyser mon CV";
        analyzeBtn.disabled = false;
    };

    reader.readAsDataURL(file);
});
</script>

</body>
</html>
